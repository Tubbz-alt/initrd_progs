#!/bin/sh
# w dir inside musl-cross-make

for app in gcc make ; do
	if ! $app --version &>/dev/null ; then
		echo -e "\033[1;31m""$app is not installed""\033[0m"
		exit 1
	fi
done

#---

TG=$1

if [ ! -f "$TG" -o "$TG" = config.mak -o "$TG" = zconfig.mak  ] ; then
	echo "Need a target"
	exit 1
fi

DATE=$(date "+%Y%m%d")
TARCH=$(echo $TG | cut -f1 -d '-')
CC_DIR=cross-compiler-${TARCH}
CC_PKG=${CC_DIR}-${DATE}.tar.xz

cp -f zconfig.mak ../config.mak

cd ..

INSTALL_DIR=$(pwd)/${CC_DIR}
mkdir -p $INSTALL_DIR

make clean
make OUTPUT="$INSTALL_DIR" TARGET="$TG" install && \
tar -Jcf "$CC_PKG" "$CC_DIR"

mkdir -p ../0sources
mv -fv "$CC_PKG" ../0sources

echo "Done !"

### END ###
